#!/bin/bash
# Mock git command for testing

case "$1" in
  "init")
    # Mock git init - just return success
    exit 0
    ;;
  "config")
    # Mock git config - just return success
    exit 0
    ;;
  "add")
    # Mock git add - just return success
    exit 0
    ;;
  "rev-parse")
    if [ "$2" = "HEAD" ]; then
      # Return a fake commit SHA
      echo "abc123def456ghi789jkl012mno345pqr"
    else
      echo "Error: Unsupported rev-parse command" >&2
      exit 1
    fi
    ;;
  "commit")
    # Handle both "git commit -m" and "git commit -F -" (stdin)
    # Check if MOCK_GIT_COMMIT_FAIL is set to force a failure
    if [ "$MOCK_GIT_COMMIT_FAIL" = "true" ]; then
      echo "On branch main" >&2
      echo "nothing to commit, working tree clean" >&2
      exit 1
    fi
    # Simulate successful commit by returning exit code 0
    exit 0
    ;;
  "diff")
    # Handle "git diff --cached --name-only"
    if [ "$2" = "--cached" ] && [ "$3" = "--name-only" ]; then
      # Return empty (no staged changes after commit)
      exit 0
    else
      echo "Error: Unsupported diff command" >&2
      exit 1
    fi
    ;;
  "status")
    # Return simple status output
    cat <<'EOF'
On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean
EOF
    ;;
  "log")
    # Handle "git log -1 --format=..."
    if [ "$2" = "-1" ] && [ "$3" = "--format=%B" ]; then
      # Return a sample commit message with metrics
      cat <<'EOF'
Test commit subject

Test body content

Co-Authored-By: ðŸ¤– Claude Code <noreply@anthropic.com>
Claude-Cost-Metrics: {"sessionId":"test","cost":[{"model":"test","cost":0.05}]}
EOF
    else
      # Default: return basic log info
      echo "commit abc123def456ghi789jkl012mno345pqr"
      echo "Author: Test User <test@example.com>"
      echo "Date: Mon Dec 19 00:00:00 2025 +0000"
    fi
    ;;
  *)
    echo "Error: Unsupported git command: $1" >&2
    exit 1
    ;;
esac
