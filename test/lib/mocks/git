#!/bin/bash
# Mock git command for testing

case "$1" in
  "init")
    # Mock git init - just return success
    exit 0
    ;;
  "config")
    # Mock git config - just return success
    exit 0
    ;;
  "add")
    # Mock git add - just return success
    exit 0
    ;;
  "rev-parse")
    if [ "$2" = "HEAD" ]; then
      # Return a fake commit SHA
      echo "abc123def456ghi789jkl012mno345pqr"
    else
      echo "Error: Unsupported rev-parse command" >&2
      exit 1
    fi
    ;;
  "commit")
    # Extract message from -m flag
    shift  # Remove "commit"
    shift  # Remove "-m"
    local message="$1"

    # Simulate successful commit by returning exit code 0
    # In real tests, this can be controlled by environment variables
    exit 0
    ;;
  "status")
    # Return simple status output
    cat <<'EOF'
On branch main
Your branch is up to date with 'origin/main'.

nothing to commit, working tree clean
EOF
    ;;
  "log")
    # Handle "git log -1 --format=..."
    if [ "$2" = "-1" ] && [ "$3" = "--format=%B" ]; then
      # Return a sample commit message with metrics
      cat <<'EOF'
Test commit subject

Test body content

Co-Authored-By: ðŸ¤– Claude Code <noreply@anthropic.com>
Claude-Cost-Metrics: {"sessionId":"test","cost":[{"model":"test","cost":0.05}]}
EOF
    else
      # Default: return basic log info
      echo "commit abc123def456ghi789jkl012mno345pqr"
      echo "Author: Test User <test@example.com>"
      echo "Date: Mon Dec 19 00:00:00 2025 +0000"
    fi
    ;;
  *)
    echo "Error: Unsupported git command: $1" >&2
    exit 1
    ;;
esac
